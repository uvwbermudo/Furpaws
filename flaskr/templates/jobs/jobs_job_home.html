<div id="job_home_cont" class="">
    <div id="job_home_controls" >
        <button type="button" style="z-index: 20;" class="button-17 add-job-btn border-0" data-bs-toggle="modal" data-bs-target="#create-job-form" >&plus; Post Job</button>
    </div>
    <div id="job_home_feed" class="">
	{% set all_jobs_PE = jobs_posted + ongoing_jobs %}
	
		<!-- FREELANCER LAYOUT -->
		{% if current_user.account_type=='freelancer' %}
		<div class="d-flex flex-row w-100 align-items-center" style="column-gap: 5px;">
            <span class="d-inline-block text-muted" style="font-size: 12px;">Your Job Applications</span>
            <hr class="d-inline-block d-inline" style="flex:1; margin-right:25px">
        </div>

		<div id="FL-applications-cont">
			{% if applied_to|length == 0 %}
            <h5 style="margin-top: 10px; margin-left:25px;" class="text-muted d-block">You currently have no job applications.</h5>
            {% else %}
			{% for application in applied_to %}
			{% set job = application.job_details %}
			<div class="FL-job-apply" style="margin-top: 10px;" >
                    <div>
                        <img src="../../static/img/freelancer_sample.jpg" class="rounded-pfp">
                    </div>
                    <div>
                        <span  class="text-muted fs-10">Pet Owner</span>
                        <span class="fs-12 fw-bolder" style="max-width: 120px; white-space:wrap;">
							{{job.poster_details.first_name.split(' ')[0]}} {{job.poster_details.last_name}}
						</span>
                    </div>
                    <div class> 
                        <span class="text-muted fs-10">Job type</span>
                        <span class="fs-12 fw-semibold">{{job.job_type}}</span>
                    </div>      
                    <div>
                        <span  class="text-muted fs-10">Job Schedule</span>
                        <span class="fs-12 fw-semibold" style="max-width: 80px; white-space:wrap;">{{job.job_schedule}}</span>
                    </div>
                    <div>
                        <span class="text-muted fs-10">Application Status</span>
                        <span class="fs-10 badge text-bg-secondary fw-normal rounded-5" style="max-width: 60px; text-align:center;">{{application.application_status}}</span>
                    </div>
                     <div>
                        <button type="button" class="btn btn-primary fs-12 rounded-5" data-bs-toggle="modal" data-bs-target="#applied-{{job.job_id}}" style="max-width: 120px;">
                        Job Details
                      </button>
                    </div> 

                </div>
			{% endfor %}
			{%endif%}
		</div>
		<div class="d-flex flex-row w-100 align-items-center" style="column-gap: 5px;">
            <span class="d-inline-block text-muted" style="font-size: 12px;">Ongoing Jobs</span>
            <hr class="d-inline-block d-inline" style="flex:1; margin-right:25px">
        </div>
		<div id="FL-ongoing">
			{% if working_on|length ==  0%}
            <h5 style="margin-top: 10px; margin-left:25px;" class="text-muted d-block">You currently have no ongoing jobs.</h5>

			{% else %}
			{% for job in working_on %}
			<div class="PE-jobs-posted" style="margin-top: 10px;" >
				<div>
					<img src="../../static/img/test_profilepic.png" alt=""  style="border-radius: 50%; overflow:hidden;">
				</div>
				<div>
					<span  class="text-muted fs-10">Pet Owner</span>
					<span class="fs-12 fw-bolder" style="max-width: 120px; white-space:wrap;">
						{% set poster = job.job_details.poster_details%}
						<span>{{poster.first_name.split(' ')[0]}} {{poster.last_name}}</span>

					</span>
				</div>
				<div class> 
					<span class="text-muted fs-10">Job type</span>
					<span class="fs-12 fw-semibold">{{job.job_details.job_type}}</span>
				</div>      
				<div>
					<span  class="text-muted fs-10">Job Schedule</span>
					<span class="fs-12 fw-semibold" style="max-width: 80px; white-space:wrap;">{{job.job_details.job_schedule}}</span>
				</div>
				<div>
					<span  class="text-muted fs-10">Job Rate</span>
					<span class="fs-12 fw-semibold">&dollar;{{job.job_details.job_rate}}</span>
				</div>
				<div>
					<span class="text-muted fs-10">Status</span>
					<span class="fs-10 badge text-bg-warning fw-normal rounded-5" style="max-width: 60px ;">{{job.job_details.job_status}}</span>
				</div>
				<div>
					<button type="button" class="btn btn-primary fs-12 rounded-5" data-bs-toggle="modal" data-bs-target="#ongoing-{{job.job_details.job_id}}" style="max-width: 120px;">
					Job Details
				  </button>
				</div>

			</div>
			{% endfor %}
			{% endif %}
		</div>


		{% else %}


		<!-- START OF PET OWNER LAYOUT -->
        <div class="d-flex flex-row w-100 align-items-center" style="column-gap: 5px;">
            <span class="d-inline-block text-muted" style="font-size: 12px;">Your Job Postings</span>
            <hr class="d-inline-block d-inline" style="flex:1; margin-right:25px">
        </div>

        <div id="PE-job-posted-cont">
            {% if jobs_posted|length == 0 %}
            <h5 style="margin-top: 10px; margin-left:25px;" class="text-muted d-block">You currently have no job postings.</h5>
            {% else %}
						{% set applicants = [] %}
            {% for job in jobs_posted %}
                <div class="PE-jobs-posted" style="margin-top: 10px;" >
                    <div>
                        <img src="../../static/img/test_profilepic.png" alt=""  style="border-radius: 50%; overflow:hidden;">
                    </div>
                    <div>
                        <span  class="text-muted fs-10">Freelancer</span>
                        <span class="fs-12 fw-bolder" style="max-width: 120px; white-space:wrap;">
													{% if job.job_details.worker_details %}
													{% set worker = job.job_details.worker_details%}
														<span>{{worker.first_name.split(' ')[0]}} {{worker.last_name}}</span>
													{% else %}
													 <span>N/A</span>
													{% endif %}
												</span>
                    </div>
                    <div class> 
                        <span class="text-muted fs-10">Job type</span>
                        <span class="fs-12 fw-semibold">{{job.job_details.job_type}}</span>
                    </div>      
                    <div>
                        <span  class="text-muted fs-10">Job Schedule</span>
                        <span class="fs-12 fw-semibold" style="max-width: 80px; white-space:wrap;">{{job.job_details.job_schedule}}</span>
                    </div>
                    <div>
                        <span  class="text-muted fs-10">Job Rate</span>
                        <span class="fs-12 fw-semibold">&dollar;{{job.job_details.job_rate}}</span>
                    </div>
                    <div>
                        {% if job.job_status == 'Ongoing' %}
                        {% set badge_class = "text-bg-warning" %}
						{% elif job.job_status =='Waiting' %}
                        {% set badge_class = "text-bg-secondary" %}
						{% endif %}
                        <span class="text-muted fs-10">Status</span>
                        <span class="fs-10 badge {{badge_class}} fw-normal rounded-5" style="max-width: 60px ;">{{job.job_details.job_status}}</span>
                    </div>
                    <div>
                        <button type="button" class="btn btn-primary fs-12 rounded-5" data-bs-toggle="modal" data-bs-target="#job-{{job.job_details.job_id}}" style="max-width: 120px;">
                        Job Details
                      </button>
                    </div>

                </div>
            
						
			{% set applicants = applicants.extend(job.job_details.applicants) %}
            {%endfor%}
            {% endif %}
        </div>
			<div class="d-flex flex-row w-100 align-items-center" style="column-gap: 5px;">
			<span class="d-inline-block text-muted" style="font-size: 12px;">Ongoing Jobs</span>
			<hr class="d-inline-block d-inline" style="flex:1; margin-right:25px">
			</div>

			<!-- ONGOING JOBS -->
			<div id="PE-ongoing-cont">
			{% if ongoing_jobs|length == 0 %}
            <h5 style="margin-top: 10px; margin-left:25px;" class="text-muted d-block">You currently have no ongoing jobs.</h5>
            {% else %}
            {% for job in ongoing_jobs %}
                <div class="PE-jobs-posted" style="margin-top: 10px;" >
                    <div>
                        <img src="../../static/img/test_profilepic.png" alt=""  style="border-radius: 50%; overflow:hidden;">
                    </div>
                    <div>
                        <span  class="text-muted fs-10">Freelancer</span>
                        <span class="fs-12 fw-bolder" style="max-width: 120px; white-space:wrap;">
													{% if job.job_details.worker_details %}
													{% set worker = job.job_details.worker_details%}
														<span>{{worker.first_name.split(' ')[0]}} {{worker.last_name}}</span>
													{% else %}
													 <span>N/A</span>
													{% endif %}
												</span>
                    </div>
                    <div class> 
                        <span class="text-muted fs-10">Job type</span>
                        <span class="fs-12 fw-semibold">{{job.job_details.job_type}}</span>
                    </div>      
                    <div>
                        <span  class="text-muted fs-10">Job Schedule</span>
                        <span class="fs-12 fw-semibold" style="max-width: 80px; white-space:wrap;">{{job.job_details.job_schedule}}</span>
                    </div>
                    <div>
                        <span  class="text-muted fs-10">Job Rate</span>
                        <span class="fs-12 fw-semibold">&dollar;{{job.job_details.job_rate}}</span>
                    </div>
                    <div>
                        {% if job.job_status == 'Ongoing' %}
                        {% set badge_class = "text-bg-warning" %}
												{% elif job.job_status =='Waiting' %}
                        {% set badge_class = "text-bg-secondary" %}
												{% endif %}
                        <span class="text-muted fs-10">Status</span>
                        <span class="fs-10 badge {{badge_class}} fw-normal rounded-5" style="max-width: 60px ;">{{job.job_details.job_status}}</span>
                    </div>
                    <div>
                        <button type="button" class="btn btn-primary fs-12 rounded-5" data-bs-toggle="modal" data-bs-target="#job-{{job.job_details.job_id}}" style="max-width: 120px;">
                        Job Details
                      </button>
                    </div>

                </div>
            
						
            {%endfor%}
            {% endif %}
			</div>
			
			<!-- JOB APPLICANTS -->
			<div class="d-flex flex-row w-100 align-items-center" style="column-gap: 5px;">
					<span class="d-inline-block text-muted" style="font-size: 12px;">Applicants</span>
					<hr class="d-inline-block d-inline" style="flex:1; margin-right:25px">
			</div>
			<div id="PE-applicants-cont">
				{% if applicants|length == 0 %}
				<h5 style="margin-top: 10px; margin-left:25px;" class="text-muted d-block">No applicants.</h5>
				{% else %}
				{% for job in jobs_posted %}
					{% for applicant in job.job_details.applicants %}
						<div class="PE-applicant">

							<div>
								<img src="../../static/img/test_profilepic.png" alt="">
							</div>
							<div>
								{% set first_name = applicant.first_name.split(' ')[0] %}
								<span class="fs-10 text-muted">Freelancer</span>
								<span class="fs-12 fw-semibold">{{first_name}} {{applicant.last_name}} </span>
							</div>
							<div>
								<span class="fs-10 text-muted">Job Applied</span>
								<span class="fs-12 fw-semibold">{{job.job_details.job_type}}</span>
							</div>
							<div>
								<span class="fs-10 text-muted">Scheduled On</span>
								<span class="fs-12 fw-semibold" style="max-width: 80px; white-space:wrap;">{{job.job_details.job_schedule}}</span>
							</div>
							<div>
								<a href="/profiles/{{applicant.tag}}" type="button" class="btn btn-primary rounded-5 fs-12">
									View Profile 
								</a>
								<button type="button" class="btn btn-outline-primary rounded-5 fs-12" data-bs-toggle="modal" data-bs-target="#hire-applicant-{{applicant.tag}}{{job.job_id}}">
									Hire 
								</button>
							</div>

						</div>
						
					{% endfor %}
				{% endfor %}
				{% endif %}
			</div>
		
			{% endif %}

    </div>
</div> 

<!-- MODALS -->
<!-- ADD JOB MODAL -->
<div class="modals-container">
<div class="modal fade" id="create-job-form" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
        <form action="/jobs/pet-owner/create-jobs" method="post" style="font-family: Poppins, sans-serif;">
			<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
      <div class="modal-header">
        <h1 class="modal-title fs-6 fw-semibold" id="exampleModalLabel">Create Job </h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
          <div class="mb-3" style="font-size: 14px;">
			<label for="job-type" class="form-label">Job type</label>		
            <select name="job_type" class="form-select" aria-label="Default select example">
				<option value="Pet Walk">Walking</option>
				<option value="Vet Escort">Vet Escort</option>
				<option value="Pet Sitting">Pet Sitting</option>
				<option value="Feeding">Feeding</option>
				<option value="Others">Others</option>
			  </select>
          </div>

		  <div class="mb-3">
            <label for="job-schedule" class="form-label">Schedule</label>
			<input type="datetime-local" id="job-schedule" name="job_schedule" class="form-control" min="">
          </div>

		  <div class="mb-3">
            <label for="job-rate" class="form-label">Job rate</label>
			<input type="number" onkeypress="return event.charCode >= 48 && event.charCode <= 57" id="job-rate" name="job_rate" min="1.00" 
			step=".01" class="form-control" placeholder="$">
          </div>
		
          <div class="mb-3">
            <label for="message-text" class="form-label">Job Details</label>
            <textarea class="form-control" name="job_description" id="message-text" style="max-height:100px;"></textarea>
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Confirm</button>
      </div>
    </form>
    </div>
  </div>
</div>	

<!-- Job details Modal PET OWNER -->
{% for job in all_jobs_PE %}
{% set current_job= job.job_id%}
	<!-- GET APPLICANTS -->
	{% if job.job_details.applicants %}
	{% for applicant in job.job_details.applicants %}
	<div class="modal fade" id="hire-applicant-{{applicant.tag}}{{job.job_id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h1 class="modal-title fs-5">Modal title</h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					{{job.job_id}}
				</div>
				<div class="modal-footer">
					<form action="/jobs/pet-owner/hire" method="post">
						<input type="hidden" value="{{csrf_token()}}" name="csrf_token">
						<input type="hidden" value="{{applicant.tag}}" name="applicant_tag">
						<input type="hidden" value="{{current_job}}" name="job_id">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-primary">Hire</button>
					</form>

				</div>
			</div>
		</div>
	</div>
	{% endfor %}
	{% endif %}

  <div class="modal fade" id="job-{{job.job_details.job_id}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
	  <div class="modal-content">
		<div class="modal-body w-100 d-flex flex-column">
			<button type="button" class="btn-close ms-auto" data-bs-dismiss="modal" aria-label="Close"></button>
			{# {% if job.job_details.job_status == 'Waiting' %}
			<button class="btn btn-warning w-25 ms-auto text-white"><i class="fa-solid fa-pen-to-square"></i>Edit</button>
			{% endif %}#}
			<div class="fs-14 w-100">
				<div class="w-100 d-flex justify-content-evenly pb-2">
					<img src="../../static/img/job_detail_jobtype.png" class="circle-pfp flex-shrink-1" alt="" style="height: 80px; width:80px;">
					<img src="../../static/img/job_detail_rate.png" class="circle-pfp flex-shrink-1" alt="" style="height: 80px; width:80px;" >
					<img src="../../static/img/job_detail_status.png" class="circle-pfp flex-shrink-1" alt="" style="height: 80px; width:80px;">
					<img src="../../static/img/job_detail_schedule.png" class="circle-pfp flex-shrink-1" alt="" style="height: 80px; width:80px;">
				</div>
				<div class="w-100 d-flex justify-content-evenly fs-12" style="text-align: center;">
					<div class="d-flex flex-column gy-5 flex-shrink-1" style="width: 80px;">
						<span class="fw-bold d-block" style="width:80px;">Status</span> <span>{{job.job_status}}</span>
					</div>
					<div class="d-flex flex-column gy-5 flex-shrink-1" style="width: 80px;">
						<span class="fw-bold d-block" style="width:80px;">Job Rate</span> <span>{{job.job_details.job_rate}}</span>
					</div>
					<div class="d-flex flex-column gy-5 flex-shrink-1" style="width: 80px;">
						<span class="fw-bold d-block" style="width:80px; ">Job type</span> <span>{{job.job_details.job_type}}</span>
					</div>
					<div class="d-flex flex-column gy-5 flex-shrink-1" style="width: 80px;">
						<span class="fw-bold d-block" style="width:80px;">Schedule</span> <span style="white-space:wrap; width:80px;">{{job.job_details.job_schedule}}</span>
					</div>
				</div>
				<div class="d-flex gx-5 w-100">
					<span class="fw-bold d-block" style="width:120px;">Job Description</span>
				</div>
				<p style="font-size: 14px; padding:15px; margin-top:10px; text-align:center;" class="fst-italic">
					"{{job.job_details.job_description}}"
				</p>
			</div>
		</div>
		<div class="modal-footer">
			<!-- CANCEL JOB SECTION -->
			<form action="/jobs/pet-owner/cancel-job" method="post">
				<input type="hidden" value="{{csrf_token()}}" name="csrf_token">
				<input type="hidden" value="{{job.job_details.job_id}}" name="job_id">
			<span class="hide cancel-span">Cancel Job?</span>
		  <button type="button" onclick="toggle_cancel_job('{{job.job_details.job_id}}')" class="btn btn-danger cancel-job">Cancel Job</button>
			<button type="submit" class="btn btn-outline-danger hide confirm-cancel" data-bs-dismiss="modal">Confirm </button>
		  <button type="button" onclick="toggle_cancel_job('{{job.job_details.job_id}}')" class="btn btn-outline-secondary hide cancel-cancel" >Back</button>
			</form>
		  {% if job.job_details.job_status == 'Ongoing' %}
			<!-- COMPlETE JOB SECTION -->
			<span class="hide complete-span">Complete Job?</span>
		  <button type="button" class="btn btn-success complete-job" data-bs-toggle="modal" data-bs-target="#complete-{{job.job_details.job_id}}">Complete Job</button>
		  {% else %}
		  <button type="button" class="btn btn-secondary close" data-bs-dismiss="modal">Close</button>
		  {% endif %}
		</div>
	  </div>
	</div>
  </div>

	<!-- COMPLETE JOB MODAL -->
	{% set worker = job.job_details.worker_details %}
	<div class="modal fade" id="complete-{{job.job_details.job_id}}" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
		<form action="/jobs/pet-owner/complete-job" method="post">
			<input type="hidden" value="{{csrf_token()}}" name="csrf_token">
			<input type="hidden" value="{{job.job_details.job_id}}" name="job_id">
		<div class="modal-dialog modal-dialog-centered modal-scrollable">
			<div class="modal-content">
				<div class="modal-header">
					<h1 class="modal-title fs-5" id="exampleModalToggleLabel2">Complete Job</h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body d-flex flex-column align-items-center w-100">
					<img src="../../static/img/freelancer_sample.jpg" alt="" style="height: 200px; width:200px;" class="circle-pfp">
					<span class="pt-2 fw-bolder">{{worker.first_name}} {{worker.last_name}}</span>
					<span class="pt-3 fw-semibold">Rate your freelancer</span>
					<div class="rating" id="rating{{job.job_details.job_id}}" hx-get="/jobs/rating/{{job.job_details.job_id}}" hx-target="#rating{{job.job_details.job_id}}" hx-swap="outerHTML" hx-trigger="load">
					</div>
					<div class="form-floating w-100">
						<textarea class="form-control" placeholder="Leave a review" id="floatingTextarea" name="review"></textarea>
						<label for="floatingTextarea text-muted">Review </label>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-outline-success confirm-complete">Complete
						<i class="fa-solid fa-check-double"></i>
					</button>
					<button type="button" class="btn btn-secondary cancel-complete" data-bs-toggle="modal" data-bs-target="#job-{{job.job_details.job_id}}">Back</button>
				</div>
			</div>
		</div>
	</form>
	</div>
	
	{% endfor%}
	<!-- Job Application Modal -->


<!-- FREELANCER jobs applied to -->
{% for job in applied_to %}
<div class="modal fade" id="applied-{{job.job_details.job_id}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
	<div class="modal-content">
	  <div class="modal-header">
		<h1 class="modal-title fs-5" id="staticBackdropLabel3">Job Details</h1>
		<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	  </div>
	  <div class="modal-body" style="background-color:rgba(167, 144, 144, 0.212);">
		  <p style="font-size: 14px;">{{job.job_details.poster_details}}</p>
	  </div>
	  <div class="modal-footer">
		  <!-- !! SHOULD BE CANCEL -->
		  <form action="/jobs/freelancer/cancel-job" method="post">
			  <input type="hidden" value="{{csrf_token()}}" name="csrf_token">
			  <input type="hidden" value="{{job.id}}" name="job_id">
		  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		<button type="submit" class="btn btn-danger" >
		  <span >Cancel</span>
		</button>
		  </form>
	  </div>
	</div>
  </div>
</div>
{% endfor%}

<!-- FREELANCER ONGOING JOBS -->
{% for job in working_on  %}
 <div class="modal fade" id="ongoing-{{job.job_details.job_id}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
	<div class="modal-content">
	  <div class="modal-header">
		<h1 class="modal-title fs-5" id="staticBackdropLabel1">Job Details</h1>
		<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	  </div>
	  <div class="modal-body w-100 d-flex flex-column">
		  <div class="fs-14 container">
			  <div class="d-flex gx-5 w-100">
				  <span class="fw-bold d-block" style="width:150px;">Status:</span> <span>{{job.job_details.job_status}}</span>
			  </div>
			  <div class="d-flex gx-5 w-100">
				  <span class="fw-bold d-block" style="width:150px;">Job Rate:</span> <span>{{job.job_details.job_rate}}</span>
			  </div>
			  <div class="d-flex gx-5 w-100">
				  <span class="fw-bold d-block" style="width:150px;">Job type:</span> <span>{{job.job_details.job_type}}</span>
			  </div>
			  <div class="d-flex gx-5 w-100">
				  <span class="fw-bold d-block" style="width:150px;">Job Schedule:</span> <span>{{job.job_details.job_schedule}}</span>
			  </div>
			  <div class="d-flex gx-5 w-100">
				  <span class="fw-bold d-block" style="width:150px;">Job Description:</span>
			  </div>
			  <p style="font-size: 14px; background-color:antiquewhite; padding:15px; margin-top:10px;">
				  {{job.job_details.job_description}}
			  </p>
		  </div>
	  </div>
	  <div class="modal-footer">
		<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
	  </div>
	</div>
  </div>
</div>
{%endfor%}


</div>